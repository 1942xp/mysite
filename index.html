<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Birlikte Ä°zleme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>ðŸŽ¬ Birlikte Ä°zleme</h2>

<video id="video" width="100%" controls>
  <source src="video.mp4" type="video/mp4">
</video>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBechvUwDzQ5gD8cdiDN_qSObt7RFKKUg",
    authDomain: "birlikte-izleme.firebaseapp.com",
    databaseURL: "https://birlikte-izleme-default-rtdb.firebaseio.com",
    projectId: "birlikte-izleme",
    storageBucket: "birlikte-izleme.firebasestorage.app",
    messagingSenderId: "488401543618",
    appId: "1:488401543618:web:e758697faebdeabb64765b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const video = document.getElementById("video");
  const roomRef = ref(db, "room1");

  let isRemote = false;

  // ðŸŽ¯ LOCAL â†’ FIREBASE
  video.addEventListener("play", () => {
    if (isRemote) return;
    set(roomRef, {
      playing: true,
      time: video.currentTime
    });
  });

  video.addEventListener("pause", () => {
    if (isRemote) return;
    set(roomRef, {
      playing: false,
      time: video.currentTime
    });
  });

  video.addEventListener("seeked", () => {
    if (isRemote) return;
    set(roomRef, {
      playing: !video.paused,
      time: video.currentTime
    });
  });

  // ðŸ” FIREBASE â†’ REMOTE
  onValue(roomRef, (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    isRemote = true;

    if (Math.abs(video.currentTime - data.time) > 0.5) {
      video.currentTime = data.time;
    }

    if (data.playing && video.paused) video.play();
    if (!data.playing && !video.paused) video.pause();

    setTimeout(() => isRemote = false, 300);
  });
</script>

</body>
</html>
